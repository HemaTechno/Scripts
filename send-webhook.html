<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Scripts</title>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #121212;
            color: #fff;
            text-align: center;
            padding: 20px;
        }
        h1 {
            margin-bottom: 20px;
            color: #ffa726; /* Title color */
        }
        .script-container {
            background-color: #2e2e2e;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: left;
        }
        button {
            margin: 10px 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px; /* Button font size */
        }
        .approve-btn {
            background-color: #4CAF50; /* Approve button color */
            color: white;
        }
        .approve-btn:hover {
            background-color: #45a049; /* Approve button hover color */
        }
        .reject-btn {
            background-color: #f44336; /* Reject button color */
            color: white;
        }
        .reject-btn:hover {
            background-color: #d32f2f; /* Reject button hover color */
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore-compat.js"></script>
</head>
<body>

    <h1>Review Scripts</h1>
    <div id="scriptsContainer"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBF-sE1rBlblyLGpN1m08VnQA-bvfmLvtk",
            authDomain: "public-fcf30.firebaseapp.com",
            projectId: "public-fcf30",
            storageBucket: "public-fcf30.appspot.com",
            messagingSenderId: "4481826675",
            appId: "1:4481826675:web:1663b07dcfc06fec130f06"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function loadPendingScripts() {
            const scriptsContainer = document.getElementById('scriptsContainer');
            scriptsContainer.innerHTML = '';

            db.collection("scripts").where("approved", "==", false).get().then(querySnapshot => {
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const scriptDiv = document.createElement('div');
                    scriptDiv.className = 'script-container';
                    scriptDiv.innerHTML = `
                        <h3>${data.title}</h3>
                        <p><strong>Description:</strong> ${data.description}</p>
                        <p><strong>YouTube Link:</strong> <a href="${data.youtubeLink}" target="_blank">${data.youtubeLink}</a></p>
                        <p><strong>Script Code:</strong> <pre>${data.scriptText}</pre></p>
                        <button class="approve-btn" onclick="promptForPassword('${doc.id}', '${data.title}')">Approve</button>
                        <button class="reject-btn" onclick="rejectScript('${doc.id}')">Reject</button>
                    `;
                    scriptsContainer.appendChild(scriptDiv);
                });
            }).catch(error => {
                console.error("Error loading scripts:", error);
            });
        }

        function promptForPassword(scriptId, scriptTitle) {
            const password = prompt("Please enter the password:");
            if (password === "2007") {
                approveScript(scriptId, scriptTitle);
            } else {
                alert("Incorrect password. Access denied.");
            }
        }

        function approveScript(scriptId, scriptTitle) {
            // Retrieve the Discord webhook URL from Firestore
            db.collection("settings").doc("webhook").get().then(webhookDoc => {
                if (webhookDoc.exists) {
                    const webhookUrl = webhookDoc.data().discordWebhook; // Ensure this matches your Firestore field
                    const payload = {
                        content: `A new script has been approved:\n**Title:** ${scriptTitle}\n**Script ID:** ${scriptId}`
                    };

                    // Send data to the webhook
                    fetch(webhookUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload)
                    }).then(response => {
                        if (response.ok) {
                            // Update the script status in Firestore
                            db.collection("scripts").doc(scriptId).update({ approved: true })
                                .then(() => {
                                    alert("Script approved successfully and notification sent to Discord.");
                                    loadPendingScripts(); // Reload scripts
                                }).catch(error => {
                                    console.error("Error approving script:", error);
                                });
                        } else {
                            alert("Error sending webhook data.");
                        }
                    }).catch(error => {
                        console.error("Error with webhook:", error);
                    });
                } else {
                    alert("Webhook URL not found.");
                }
            }).catch(error => {
                console.error("Error retrieving webhook URL:", error);
            });
        }

        function rejectScript(scriptId) {
            db.collection("scripts").doc(scriptId).delete()
                .then(() => {
                    alert("Script rejected successfully.");
                    loadPendingScripts(); // Reload scripts
                }).catch(error => {
                    console.error("Error rejecting script:", error);
                });
        }

        // Load pending scripts on page load
        window.onload = loadPendingScripts;
    </script>

</body>
</html>
