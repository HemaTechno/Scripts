<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم</title>
</head>
<body>
    <h2>لوحة التحكم</h2>
    <form id="controlPanelForm">
        <label for="title">العنوان:</label>
        <input type="text" id="title" name="title"><br><br>
        
        <label for="description">الوصف:</label>
        <textarea id="description" name="description"></textarea><br><br>

        <label for="imageUrl">رابط الصورة:</label>
        <input type="text" id="imageUrl" name="imageUrl"><br><br>

        <label for="youtubeLink">رابط يوتيوب:</label>
        <input type="text" id="youtubeLink" name="youtubeLink"><br><br>

        <label for="scriptText">نص السكربت:</label>
        <textarea id="scriptText" name="scriptText"></textarea><br><br>

        <button type="button" onclick="saveData()">حفظ البيانات</button>
    </form>

    <script>
        const repo = "HemaTechno/Scripts";
        const filePath = "data.json";
        const token = "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"; // استبدل هذا بالتوكن الخاص بك

        async function getSHA() {
            const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3.raw'
                }
            });
            if (response.ok) {
                const data = await response.json();
                return data.sha; // إعادة SHA الحالي
            } else {
                const errorData = await response.json();
                throw new Error(`خطأ في جلب البيانات: ${errorData.message}`);
            }
        }

        async function saveData() {
            try {
                const sha = await getSHA(); // الحصول على SHA الحالي

                const data = {
                    title: document.getElementById('title').value,
                    description: document.getElementById('description').value,
                    imageUrl: document.getElementById('imageUrl').value,
                    youtubeLink: document.getElementById('youtubeLink').value,
                    scriptText: document.getElementById('scriptText').value,
                };

                const base64Content = btoa(JSON.stringify(data)); // تحويل المحتوى إلى Base64

                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Update data.json',
                        content: base64Content,
                        sha: sha // استخدام SHA الحالي
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('تم تحديث الملف بنجاح:', result);
                    alert('تم حفظ البيانات بنجاح!');
                } else {
                    const errorData = await response.json();
                    throw new Error(`حدث خطأ في تحديث الملف: ${errorData.message}`);
                }
            } catch (error) {
                console.error('خطأ:', error);
                alert('حدث خطأ: ' + error.message);
            }
        }
    </script>
</body>
</html>
